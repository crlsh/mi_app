This file is a merged representation of the entire codebase, combining all repository files into a single document.
Generated by Repomix on: 2025-03-18 18:25:23

# File Summary

## Purpose:

This file contains a packed representation of the entire repository's contents.
It is designed to be easily consumable by AI systems for analysis, code review,
or other automated processes.

## File Format:

The content is organized as follows:
1. This summary section
2. Repository information
3. Repository structure
4. Multiple file entries, each consisting of:
   a. A header with the file path (## File: path/to/file)
   b. The full contents of the file in a code block

## Usage Guidelines:

- This file should be treated as read-only. Any changes should be made to the
  original repository files, not this packed version.
- When processing this file, use the file path to distinguish
  between different files in the repository.
- Be aware that this file may contain sensitive information. Handle it with
  the same level of security as you would the original repository.

## Notes:

- Some files may have been excluded based on .gitignore rules and Repomix's
  configuration.
- Binary files are not included in this packed representation. Please refer to
  the Repository Structure section for a complete list of file paths, including
  binary files.

## Additional Information:

For more information about Repomix, visit: https://github.com/andersonby/python-repomix


# Repository Structure

```
requirements.txt
repomix-output.md
README.md
package.json
app.py
templates
  flujo.html
  resultados.html
  index.html
```

# Repository Files


## requirements.txt

- Characters: 54
- Tokens: 0

```text
flask==2.3.3
pandas==2.1.0
openpyxl==3.1.2
xlrd==2.0.1
```

## repomix-output.md

- Characters: 36995
- Tokens: 0

```````markdown
This file is a merged representation of the entire codebase, combining all repository files into a single document.
Generated by Repomix on: 2025-03-18 18:18:37

# File Summary

## Purpose:

This file contains a packed representation of the entire repository's contents.
It is designed to be easily consumable by AI systems for analysis, code review,
or other automated processes.

## File Format:

The content is organized as follows:
1. This summary section
2. Repository information
3. Repository structure
4. Multiple file entries, each consisting of:
   a. A header with the file path (## File: path/to/file)
   b. The full contents of the file in a code block

## Usage Guidelines:

- This file should be treated as read-only. Any changes should be made to the
  original repository files, not this packed version.
- When processing this file, use the file path to distinguish
  between different files in the repository.
- Be aware that this file may contain sensitive information. Handle it with
  the same level of security as you would the original repository.

## Notes:

- Some files may have been excluded based on .gitignore rules and Repomix's
  configuration.
- Binary files are not included in this packed representation. Please refer to
  the Repository Structure section for a complete list of file paths, including
  binary files.

## Additional Information:

For more information about Repomix, visit: https://github.com/andersonby/python-repomix


# Repository Structure

```
requirements.txt
repomix-output.md
README.md
package.json
app.py
templates
  flujo.html
  resultados.html
  index.html
```

# Repository Files


## requirements.txt

- Characters: 0
- Tokens: 0

```text

```

## repomix-output.md

- Characters: 26865
- Tokens: 0

``````markdown
This file is a merged representation of the entire codebase, combining all repository files into a single document.
Generated by Repomix on: 2025-03-18 15:36:52

# File Summary

## Purpose:

This file contains a packed representation of the entire repository's contents.
It is designed to be easily consumable by AI systems for analysis, code review,
or other automated processes.

## File Format:

The content is organized as follows:
1. This summary section
2. Repository information
3. Repository structure
4. Multiple file entries, each consisting of:
   a. A header with the file path (## File: path/to/file)
   b. The full contents of the file in a code block

## Usage Guidelines:

- This file should be treated as read-only. Any changes should be made to the
  original repository files, not this packed version.
- When processing this file, use the file path to distinguish
  between different files in the repository.
- Be aware that this file may contain sensitive information. Handle it with
  the same level of security as you would the original repository.

## Notes:

- Some files may have been excluded based on .gitignore rules and Repomix's
  configuration.
- Binary files are not included in this packed representation. Please refer to
  the Repository Structure section for a complete list of file paths, including
  binary files.

## Additional Information:

For more information about Repomix, visit: https://github.com/andersonby/python-repomix


# Repository Structure

```
requirements.txt
repomix-output.md
README.md
package.json
app.py
templates
  flujo.html
  resultados.html
  index.html
```

# Repository Files


## requirements.txt

- Characters: 0
- Tokens: 0

```text

```

## repomix-output.md

- Characters: 14715
- Tokens: 0

`````markdown
This file is a merged representation of the entire codebase, combining all repository files into a single document.
Generated by Repomix on: 2025-03-18 15:31:21

# File Summary

## Purpose:

This file contains a packed representation of the entire repository's contents.
It is designed to be easily consumable by AI systems for analysis, code review,
or other automated processes.

## File Format:

The content is organized as follows:
1. This summary section
2. Repository information
3. Repository structure
4. Multiple file entries, each consisting of:
   a. A header with the file path (## File: path/to/file)
   b. The full contents of the file in a code block

## Usage Guidelines:

- This file should be treated as read-only. Any changes should be made to the
  original repository files, not this packed version.
- When processing this file, use the file path to distinguish
  between different files in the repository.
- Be aware that this file may contain sensitive information. Handle it with
  the same level of security as you would the original repository.

## Notes:

- Some files may have been excluded based on .gitignore rules and Repomix's
  configuration.
- Binary files are not included in this packed representation. Please refer to
  the Repository Structure section for a complete list of file paths, including
  binary files.

## Additional Information:

For more information about Repomix, visit: https://github.com/andersonby/python-repomix


# Repository Structure

```
requirements.txt
repomix-output.md
README.md
package.json
app.py
templates
  flujo.html
  resultados.html
  index.html
```

# Repository Files


## requirements.txt

- Characters: 0
- Tokens: 0

```text

```

## repomix-output.md

- Characters: 5821
- Tokens: 0

````markdown
This file is a merged representation of the entire codebase, combining all repository files into a single document.
Generated by Repomix on: 2025-03-18 15:11:48

# File Summary

## Purpose:

This file contains a packed representation of the entire repository's contents.
It is designed to be easily consumable by AI systems for analysis, code review,
or other automated processes.

## File Format:

The content is organized as follows:
1. This summary section
2. Repository information
3. Repository structure
4. Multiple file entries, each consisting of:
   a. A header with the file path (## File: path/to/file)
   b. The full contents of the file in a code block

## Usage Guidelines:

- This file should be treated as read-only. Any changes should be made to the
  original repository files, not this packed version.
- When processing this file, use the file path to distinguish
  between different files in the repository.
- Be aware that this file may contain sensitive information. Handle it with
  the same level of security as you would the original repository.

## Notes:

- Some files may have been excluded based on .gitignore rules and Repomix's
  configuration.
- Binary files are not included in this packed representation. Please refer to
  the Repository Structure section for a complete list of file paths, including
  binary files.

## Additional Information:

For more information about Repomix, visit: https://github.com/andersonby/python-repomix


# Repository Structure

```
requirements.txt
README.md
package.json
app.py
templates
  flujo.html
  resultados.html
  index.html
```

# Repository Files


## requirements.txt

- Characters: 0
- Tokens: 0

```text

```

## README.md

- Characters: 0
- Tokens: 0

```markdown

```

## package.json

- Characters: 51
- Tokens: 0

```json
{
  "dependencies": {
    "repomix": "^0.3.0"
  }
}
```

## app.py

- Characters: 2725
- Tokens: 0

```python
from flask import Flask, render_template, request, redirect, url_for
import pandas as pd
import os

app = Flask(__name__)

DATA_DIR = os.path.join(os.getcwd(), "data")

materiales_finales = []

# ===============================
# FUNCIONES AUXILIARES
# ===============================

def cargar_excel(nombre_archivo):
    ruta_archivo = os.path.join(DATA_DIR, nombre_archivo)
    
    if not os.path.exists(ruta_archivo):
        return None

    try:
        df = pd.read_excel(ruta_archivo)
        df.columns = df.columns.str.strip()
        for col in df.columns:
            if df[col].dtype == object:
                df[col] = df[col].astype(str).str.strip()
        return df
    except Exception as e:
        return None

def renombrar_columnas(df):
    df_renombrado = df.rename(columns={
        "1. Cód.SAP": "Cód.SAP",
        "2. MATERIAL": "MATERIAL",
        "3. Descripción": "Descripción",
        "5.CONDICIÓN": "CONDICIÓN"
    })
    columnas = ["Cód.SAP", "MATERIAL", "Descripción", "4.CANTIDAD", "CONDICIÓN"]
    return df_renombrado[[col for col in columnas if col in df_renombrado.columns]]

def procesar_flujo(nombre_flujo, siguiente_flujo, archivo):
    df = cargar_excel(archivo)
    if df is not None:
        df_renombrado = renombrar_columnas(df)
        materiales_finales.append((nombre_flujo, df_renombrado))
    return siguiente_flujo

# ===============================
# RUTAS DE LOS FLUJOS
# ===============================

@app.route("/")
def index():
    return render_template("index.html")

@app.route("/flujo/<flujo>")
def flujo(flujo):
    flujos = {
        "A": ("FLUJO A: Ajuste de medida", "ajuste_de_medida.xlsx", "B"),
        "B": ("FLUJO B: Tubo de saca", "saca_tubing.xlsx", "C"),
        "C": ("FLUJO C: Tubería de Baja", "baja_tubing.xlsx", "D"),
        "D": ("FLUJO D: Profundiza", "profundiza.xlsx", "E"),
        "E": ("FLUJO E: Baja varillas", "baja_varillas.xlsx", "F"),
        "F": ("FLUJO F: Abandona pozo", "abandono_recupero.xlsx", "G"),
        "G": ("FLUJO G: Instalación BM", "WO.xlsx", "H"),
        "H": ("FLUJO H: Material de agregación", "GENERAL.xlsx", None),
    }

    if flujo not in flujos:
        return redirect(url_for("index"))

    nombre_flujo, archivo, siguiente_flujo = flujos[flujo]
    siguiente = procesar_flujo(nombre_flujo, siguiente_flujo, archivo)
    return render_template("flujo.html", flujo=nombre_flujo, siguiente_flujo=siguiente, materiales=materiales_finales)

@app.route("/resultados")
def resultados():
    return render_template("resultados.html", materiales=materiales_finales)

# ===============================
# EJECUTAR SERVIDOR
# ===============================

if __name__ == "__main__":
    app.run(debug=True)
```

## templates/flujo.html

- Characters: 358
- Tokens: 0

```html
<!DOCTYPE html>
<html>
<head>
    <title>{{ flujo }}</title>
</head>
<body>
    <h1>{{ flujo }}</h1>
    {% if siguiente_flujo %}
        <a href="/flujo/{{ siguiente_flujo }}"><button>Continuar a Flujo {{ siguiente_flujo }}</button></a>
    {% else %}
        <a href="/resultados"><button>Ver Resultados Finales</button></a>
    {% endif %}
</body>
</html>
```

## templates/resultados.html

- Characters: 342
- Tokens: 0

```html
<!DOCTYPE html>
<html>
<head>
    <title>Resultados Finales</title>
</head>
<body>
    <h1>Listado final de materiales de todos los flujos ejecutados</h1>
    {% for flujo, df in materiales %}
        <h2>{{ flujo }}</h2>
        {{ df.to_html() | safe }}
    {% endfor %}
    <a href="/"><button>Volver al inicio</button></a>
</body>
</html>
```

## templates/index.html

- Characters: 186
- Tokens: 0

```html
<!DOCTYPE html>
<html>
<head>
    <title>Inicio</title>
</head>
<body>
    <h1>Bienvenido a la Aplicación</h1>
    <a href="/flujo/A"><button>Iniciar Flujo A</button></a>
</body>
</html>
```

## Statistics

- Total Files: 7
- Total Characters: 3662
- Total Tokens: 0
````

## README.md

- Characters: 0
- Tokens: 0

```markdown

```

## package.json

- Characters: 51
- Tokens: 0

```json
{
  "dependencies": {
    "repomix": "^0.3.0"
  }
}
```

## app.py

- Characters: 4015
- Tokens: 0

```python
from flask import Flask, render_template, request, redirect, url_for
import pandas as pd
import os

app = Flask(__name__)

DATA_DIR = os.path.join(os.getcwd(), "data")
if not os.path.exists(DATA_DIR):
    os.makedirs(DATA_DIR)

# Lista global para almacenar los materiales de cada flujo
materiales_finales = []

# ===============================
# FUNCIONES AUXILIARES
# ===============================

def cargar_excel(nombre_archivo):
    ruta_archivo = os.path.join(DATA_DIR, nombre_archivo)
    
    if not os.path.exists(ruta_archivo):
        return None

    try:
        df = pd.read_excel(ruta_archivo)
        df.columns = df.columns.str.strip()
        for col in df.columns:
            if df[col].dtype == object:
                df[col] = df[col].astype(str).str.strip()
        return df
    except Exception as e:
        return None

def renombrar_columnas(df):
    df_renombrado = df.rename(columns={
        "1. Cód.SAP": "Cód.SAP",
        "2. MATERIAL": "MATERIAL",
        "3. Descripción": "Descripción",
        "5.CONDICIÓN": "CONDICIÓN"
    })
    columnas = ["Cód.SAP", "MATERIAL", "Descripción", "4.CANTIDAD", "CONDICIÓN"]
    columnas_presentes = [col for col in columnas if col in df_renombrado.columns]
    return df_renombrado[columnas_presentes]

# ===============================
# RUTAS
# ===============================

@app.route("/")
def index():
    # Reiniciar los materiales al comenzar
    global materiales_finales
    materiales_finales = []
    return render_template("index.html")

@app.route("/flujo/<flujo>", methods=['GET', 'POST'])
def flujo(flujo):
    flujos = {
        "A": {"titulo": "FLUJO A: Ajuste de medida", "archivo": "ajuste_de_medida.xlsx", "siguiente": "H" if request.method == 'POST' and request.form.get('respuesta') == 'SI' else "B"},
        "B": {"titulo": "FLUJO B: Tubo de saca", "archivo": "saca_tubing.xlsx", "siguiente": "C"},
        "C": {"titulo": "FLUJO C: Tubería de Baja", "archivo": "baja_tubing.xlsx", "siguiente": "D"},
        "D": {"titulo": "FLUJO D: Profundiza", "archivo": "profundiza.xlsx", "siguiente": "E"},
        "E": {"titulo": "FLUJO E: Baja varillas", "archivo": "baja_varillas.xlsx", "siguiente": "G" if request.method == 'POST' and request.form.get('respuesta') == 'SI' else "F"},
        "F": {"titulo": "FLUJO F: Abandona pozo", "archivo": "abandono_recupero.xlsx", "siguiente": "H"},
        "G": {"titulo": "FLUJO G: Instalación BM", "archivo": "WO.xlsx", "siguiente": "H"},
        "H": {"titulo": "FLUJO H: Material de agregación", "archivo": "GENERAL.xlsx", "siguiente": None},
    }

    if flujo not in flujos:
        return redirect(url_for("index"))

    info_flujo = flujos[flujo]
    titulo = info_flujo["titulo"]
    archivo = info_flujo["archivo"]
    siguiente_flujo = info_flujo["siguiente"]
    
    # Si es POST, procesar respuesta
    if request.method == 'POST':
        respuesta = request.form.get('respuesta')
        
        if respuesta == 'SI':
            # Cargar y procesar el Excel
            df = cargar_excel(archivo)
            if df is not None:
                df_renombrado = renombrar_columnas(df)
                materiales_finales.append((titulo, df_renombrado))
        
        # Navegar al siguiente flujo o resultados
        if siguiente_flujo:
            return redirect(url_for("flujo", flujo=siguiente_flujo))
        else:
            return redirect(url_for("resultados"))
    
    return render_template("flujo.html", titulo=titulo, flujo=flujo)

@app.route("/resultados")
def resultados():
    # Convertir DataFrames a HTML para la plantilla
    materiales_html = []
    for titulo, df in materiales_finales:
        html_table = df.to_html(classes='table table-striped', index=False)
        materiales_html.append((titulo, html_table))
    
    return render_template("resultados.html", materiales=materiales_html)

# ===============================
# EJECUTAR SERVIDOR
# ===============================

if __name__ == "__main__":
    app.run(debug=True)
```

## templates/flujo.html

- Characters: 699
- Tokens: 0

```html
<!DOCTYPE html>
<html>
<head>
    <title>{{ flujo }}</title>
</head>
<body>
    <h1>{{ flujo }}</h1>
    {% if siguiente_flujo %}
        <a href="/flujo/{{ siguiente_flujo }}"><button>Continuar a Flujo {{ siguiente_flujo }}</button></a>
    {% else %}
        <a href="/resultados"><button>Ver Resultados Finales</button></a>
    {% endif %}
</body>
</html>
<!DOCTYPE html>
<html>
<head>
    <title>{{ flujo }}</title>
</head>
<body>
    <h1>{{ flujo }}</h1>
    <form method="POST">
        <p>¿Desea proceder con este flujo?</p>
        <button type="submit" name="respuesta" value="SI">SI</button>
        <button type="submit" name="respuesta" value="NO">NO</button>
    </form>
</body>
</html>
```

## templates/resultados.html

- Characters: 685
- Tokens: 0

```html
<!DOCTYPE html>
<html>
<head>
    <title>Resultados Finales</title>
</head>
<body>
    <h1>Listado final de materiales de todos los flujos ejecutados</h1>
    {% for flujo, df in materiales %}
        <h2>{{ flujo }}</h2>
        {{ df.to_html() | safe }}
    {% endfor %}
    <a href="/"><button>Volver al inicio</button></a>
</body>
</html>
<!DOCTYPE html>
<html>
<head>
    <title>Resultados Finales</title>
</head>
<body>
    <h1>Listado final de materiales de todos los flujos ejecutados</h1>
    {% for flujo, df in materiales %}
        <h2>{{ flujo }}</h2>
        {{ df.to_html() | safe }}
    {% endfor %}
    <a href="/"><button>Volver al inicio</button></a>
</body>
</html>
```

## templates/index.html

- Characters: 1191
- Tokens: 0

```html
<!-- templates/index.html -->
<!DOCTYPE html>
<html>
<head>
    <title>Sistema de Materiales</title>
</head>
<body>
    <h1>Sistema de Materiales</h1>
    <p>Seleccione una opción para comenzar:</p>
    <a href="/flujo/A"><button>Iniciar Flujo A: Ajuste de medida</button></a>
</body>
</html>

<!-- templates/flujo.html -->
<!DOCTYPE html>
<html>
<head>
    <title>{{ titulo }}</title>
</head>
<body>
    <h1>{{ titulo }}</h1>
    <form method="POST">
        <p>¿Desea proceder con este flujo?</p>
        <button type="submit" name="respuesta" value="SI">SI</button>
        <button type="submit" name="respuesta" value="NO">NO</button>
    </form>
    <p>
        <a href="/"><button>Volver al inicio</button></a>
    </p>
</body>
</html>

<!-- templates/resultados.html -->
<!DOCTYPE html>
<html>
<head>
    <title>Resultados Finales</title>
</head>
<body>
    <h1>Resultados Finales</h1>
    <h2>Listado final de materiales de todos los flujos ejecutados</h2>
    
    {% for titulo, tabla_html in materiales %}
        <h3>{{ titulo }}</h3>
        {{ tabla_html | safe }}
    {% endfor %}
    
    <p>
        <a href="/"><button>Volver al inicio</button></a>
    </p>
</body>
</html>
```

## Statistics

- Total Files: 8
- Total Characters: 12462
- Total Tokens: 0
`````

## README.md

- Characters: 0
- Tokens: 0

```markdown

```

## package.json

- Characters: 51
- Tokens: 0

```json
{
  "dependencies": {
    "repomix": "^0.3.0"
  }
}
```

## app.py

- Characters: 5597
- Tokens: 0

```python
from flask import Flask, render_template, request, redirect, url_for
import pandas as pd
import os

app = Flask(__name__)

DATA_DIR = os.path.join(os.getcwd(), "data")
if not os.path.exists(DATA_DIR):
    os.makedirs(DATA_DIR)

# Lista global para almacenar los materiales de cada flujo
materiales_finales = []

# ===============================
# FUNCIONES AUXILIARES
# ===============================

def cargar_excel(nombre_archivo):
    ruta_archivo = os.path.join(DATA_DIR, nombre_archivo)
    
    if not os.path.exists(ruta_archivo):
        print(f"Archivo no encontrado: {ruta_archivo}")
        return None

    try:
        df = pd.read_excel(ruta_archivo)
        df.columns = df.columns.str.strip()
        for col in df.columns:
            if df[col].dtype == object:
                df[col] = df[col].astype(str).str.strip()
        return df
    except Exception as e:
        print(f"Error cargando {nombre_archivo}: {e}")
        return None

def renombrar_columnas(df):
    if df is None:
        print("DataFrame es None en renombrar_columnas")
        return pd.DataFrame()
        
    df_renombrado = df.rename(columns={
        "1. Cód.SAP": "Cód.SAP",
        "2. MATERIAL": "MATERIAL",
        "3. Descripción": "Descripción",
        "5.CONDICIÓN": "CONDICIÓN"
    })
    columnas = ["Cód.SAP", "MATERIAL", "Descripción", "4.CANTIDAD", "CONDICIÓN"]
    columnas_presentes = [col for col in columnas if col in df_renombrado.columns]
    
    # Si no hay columnas presentes, devolver un DataFrame vacío
    if not columnas_presentes:
        print(f"No se encontraron columnas válidas. Columnas disponibles: {df.columns.tolist()}")
        return pd.DataFrame()
        
    return df_renombrado[columnas_presentes]

def procesar_flujo(titulo, archivo):
    """Procesa un archivo Excel y agrega los datos a la lista de materiales."""
    print(f"Procesando flujo: {titulo}, archivo: {archivo}")
    
    df = cargar_excel(archivo)
    if df is not None:
        # Mostrar las primeras filas para debug
        print(f"Columnas del DataFrame: {df.columns.tolist()}")
        print(f"Primeras filas:\n{df.head()}")
        
        df_renombrado = renombrar_columnas(df)
        
        if not df_renombrado.empty:
            materiales_finales.append((titulo, df_renombrado))
            print(f"Material agregado para {titulo}")
        else:
            print(f"DataFrame renombrado está vacío para {titulo}")
    else:
        print(f"No se pudo cargar el archivo para {titulo}")

# ===============================
# RUTAS
# ===============================

@app.route("/")
def index():
    # Reiniciar los materiales al comenzar
    global materiales_finales
    materiales_finales = []
    return render_template("index.html")

@app.route("/flujo/<flujo>", methods=['GET', 'POST'])
def flujo(flujo):
    flujos = {
        "A": {"titulo": "FLUJO A: Ajuste de medida", "archivo": "ajuste_de_medida.xlsx", "siguiente": "H"},
        "B": {"titulo": "FLUJO B: Tubo de saca", "archivo": "saca_tubing.xlsx", "siguiente": "C"},
        "C": {"titulo": "FLUJO C: Tubería de Baja", "archivo": "baja_tubing.xlsx", "siguiente": "D"},
        "D": {"titulo": "FLUJO D: Profundiza", "archivo": "profundiza.xlsx", "siguiente": "E"},
        "E": {"titulo": "FLUJO E: Baja varillas", "archivo": "baja_varillas.xlsx", "siguiente": "G"},
        "F": {"titulo": "FLUJO F: Abandona pozo", "archivo": "abandono_recupero.xlsx", "siguiente": "H"},
        "G": {"titulo": "FLUJO G: Instalación BM", "archivo": "WO.xlsx", "siguiente": "H"},
        "H": {"titulo": "FLUJO H: Material de agregación", "archivo": "GENERAL.xlsx", "siguiente": None},
    }

    if flujo not in flujos:
        return redirect(url_for("index"))

    info_flujo = flujos[flujo]
    titulo = info_flujo["titulo"]
    archivo = info_flujo["archivo"]
    siguiente_flujo = info_flujo["siguiente"]
    
    # Si es POST, procesar respuesta
    if request.method == 'POST':
        respuesta = request.form.get('respuesta')
        
        if respuesta == 'SI':
            # Procesar el Excel según la respuesta
            print(f"Respuesta SI para {titulo}")
            procesar_flujo(titulo, archivo)
                
            # Casos especiales de navegación
            if flujo == "A":
                siguiente_flujo = "H"  # Si responde SI en A, ir a H
            elif flujo == "E":
                siguiente_flujo = "G"  # Si responde SI en E, ir a G
        else:
            # Si responde NO, seguir la navegación normal o casos especiales
            if flujo == "E":
                siguiente_flujo = "F"  # Si responde NO en E, ir a F
            print(f"Respuesta NO para {titulo}, siguiente: {siguiente_flujo}")
        
        # Navegar al siguiente flujo o resultados
        if siguiente_flujo:
            return redirect(url_for("flujo", flujo=siguiente_flujo))
        else:
            return redirect(url_for("resultados"))
    
    # Para peticiones GET, mostrar la página con los botones SI/NO
    return render_template("flujo.html", titulo=titulo, flujo=flujo)

@app.route("/resultados")
def resultados():
    print(f"Mostrando resultados, {len(materiales_finales)} materiales registrados")
    
    # Asegurarnos de tener datos para mostrar
    if not materiales_finales:
        return "No hay materiales registrados. <a href='/'>Volver al inicio</a>"
    
    return render_template("resultados.html", materiales=materiales_finales)

# ===============================
# EJECUTAR SERVIDOR
# ===============================

if __name__ == "__main__":
    app.run(debug=True)
```

## templates/flujo.html

- Characters: 417
- Tokens: 0

```html
<!DOCTYPE html>
<html>
<head>
    <title>{{ titulo }}</title>
</head>
<body>
    <h1>{{ titulo }}</h1>
    <form method="POST">
        <p>¿Desea proceder con este flujo?</p>
        <button type="submit" name="respuesta" value="SI">SI</button>
        <button type="submit" name="respuesta" value="NO">NO</button>
    </form>
    <p>
        <a href="/"><button>Volver al inicio</button></a>
    </p>
</body>
</html>
```

## templates/resultados.html

- Characters: 1627
- Tokens: 0

```html
<!-- templates/resultados.html -->
<!DOCTYPE html>
<html>
<head>
    <title>Resultados Finales</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        h1, h2 { color: #333; }
        table { 
            border-collapse: collapse; 
            width: 100%; 
            margin-bottom: 30px;
        }
        th, td { 
            border: 1px solid #ddd; 
            padding: 8px; 
            text-align: left;
        }
        th { 
            background-color: #4CAF50; 
            color: white; 
        }
        tr:nth-child(even) { background-color: #f2f2f2; }
        .btn-home { 
            padding: 10px 15px; 
            background-color: #2196F3; 
            color: white; 
            border: none; 
            cursor: pointer; 
            font-size: 16px;
        }
        .btn-home:hover { background-color: #0b7dda; }
        .flujo-section { 
            margin-bottom: 40px;
            border: 1px solid #ddd;
            padding: 15px;
            border-radius: 5px;
        }
    </style>
</head>
<body>
    <h1>Resultados Finales</h1>
    <h2>Listado final de materiales de todos los flujos ejecutados</h2>
    
    {% for flujo, df in materiales %}
        <div class="flujo-section">
            <h2>{{ flujo }}</h2>
            {% if df.empty %}
                <p>No hay datos disponibles para este flujo.</p>
            {% else %}
                {{ df.to_html(classes="data-table", index=False) | safe }}
            {% endif %}
        </div>
    {% endfor %}
    
    <a href="/"><button class="btn-home">Volver al inicio</button></a>
</body>
</html>
```

## templates/index.html

- Characters: 2201
- Tokens: 0

```html
<!-- templates/index.html -->
<!DOCTYPE html>
<html>
<head>
    <title>Sistema de Materiales</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        h1 { color: #333; }
        button { 
            padding: 10px 15px; 
            background-color: #4CAF50; 
            color: white; 
            border: none; 
            cursor: pointer; 
            font-size: 16px;
        }
        button:hover { background-color: #45a049; }
    </style>
</head>
<body>
    <h1>Sistema de Materiales</h1>
    <p>Esta aplicación le permite gestionar el flujo de materiales.</p>
    <a href="/flujo/A"><button>Iniciar Flujo A: Ajuste de medida</button></a>
</body>
</html>

<!-- templates/flujo.html -->
<!DOCTYPE html>
<html>
<head>
    <title>{{ titulo }}</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        h1 { color: #333; }
        .btn-si { 
            padding: 10px 15px; 
            background-color: #4CAF50; 
            color: white; 
            border: none; 
            cursor: pointer; 
            font-size: 16px;
            margin-right: 10px;
        }
        .btn-no { 
            padding: 10px 15px; 
            background-color: #f44336; 
            color: white; 
            border: none; 
            cursor: pointer; 
            font-size: 16px;
        }
        .btn-home { 
            padding: 8px 12px; 
            background-color: #2196F3; 
            color: white; 
            border: none; 
            cursor: pointer; 
            margin-top: 20px;
        }
        .btn-si:hover { background-color: #45a049; }
        .btn-no:hover { background-color: #da190b; }
        .btn-home:hover { background-color: #0b7dda; }
    </style>
</head>
<body>
    <h1>{{ titulo }}</h1>
    
    <div>
        <p>¿Desea proceder con este flujo?</p>
        <form method="POST">
            <button type="submit" name="respuesta" value="SI" class="btn-si">SI</button>
            <button type="submit" name="respuesta" value="NO" class="btn-no">NO</button>
        </form>
    </div>
    
    <div>
        <a href="/"><button class="btn-home">Volver al inicio</button></a>
    </div>
</body>
</html>
```

## Statistics

- Total Files: 8
- Total Characters: 24608
- Total Tokens: 0
``````

## README.md

- Characters: 0
- Tokens: 0

```markdown

```

## package.json

- Characters: 51
- Tokens: 0

```json
{
  "dependencies": {
    "repomix": "^0.3.0"
  }
}
```

## app.py

- Characters: 4609
- Tokens: 0

```python
from flask import Flask, render_template, request, redirect, url_for
import pandas as pd
import os

app = Flask(__name__)

DATA_DIR = os.path.join(os.getcwd(), "data")
if not os.path.exists(DATA_DIR):
    os.makedirs(DATA_DIR)

# Lista global para almacenar los materiales de cada flujo
materiales_finales = []

# ===============================
# FUNCIONES AUXILIARES
# ===============================

def cargar_excel(nombre_archivo):
    ruta_archivo = os.path.join(DATA_DIR, nombre_archivo)
    
    if not os.path.exists(ruta_archivo):
        print(f"Archivo no encontrado: {ruta_archivo}")
        return None

    try:
        df = pd.read_excel(ruta_archivo)
        df.columns = df.columns.str.strip()
        for col in df.columns:
            if df[col].dtype == object:
                df[col] = df[col].astype(str).str.strip()
        print(f"Excel cargado correctamente: {nombre_archivo}")
        print(f"Columnas encontradas: {df.columns.tolist()}")
        return df
    except Exception as e:
        print(f"Error cargando {nombre_archivo}: {e}")
        return None

def renombrar_columnas(df):
    if df is None:
        print("DataFrame es None en renombrar_columnas")
        return pd.DataFrame()
        
    # Imprimir columnas originales para debug
    print(f"Columnas antes de renombrar: {df.columns.tolist()}")
    
    df_renombrado = df.rename(columns={
        "1. Cód.SAP": "Cód.SAP",
        "2. MATERIAL": "MATERIAL",
        "3. Descripción": "Descripción",
        "5.CONDICIÓN": "CONDICIÓN"
    })
    
    # Imprimir columnas después de renombrar para debug
    print(f"Columnas después de renombrar: {df_renombrado.columns.tolist()}")
    
    columnas = ["Cód.SAP", "MATERIAL", "Descripción", "4.CANTIDAD", "CONDICIÓN"]
    columnas_presentes = [col for col in columnas if col in df_renombrado.columns]
    
    # Si no hay columnas presentes, devolver el DataFrame original
    if not columnas_presentes:
        print(f"No se encontraron columnas válidas después de renombrar.")
        # Usar todas las columnas originales
        return df
    
    print(f"Columnas finales seleccionadas: {columnas_presentes}")
    return df_renombrado[columnas_presentes]

def procesar_flujo(nombre_flujo, siguiente_flujo, archivo):
    """Carga y procesa un archivo Excel, y agrega los datos a la lista de materiales."""
    print(f"Procesando flujo: {nombre_flujo}, archivo: {archivo}")
    
    df = cargar_excel(archivo)
    if df is not None:
        # Renombrar columnas
        df_renombrado = renombrar_columnas(df)
        
        if not df_renombrado.empty:
            materiales_finales.append((nombre_flujo, df_renombrado))
            print(f"Material agregado para {nombre_flujo}, filas: {len(df_renombrado)}")
        else:
            print(f"DataFrame renombrado está vacío para {nombre_flujo}")
    else:
        print(f"No se pudo cargar el archivo para {nombre_flujo}")
    
    return siguiente_flujo

# ===============================
# RUTAS
# ===============================

@app.route("/")
def index():
    # Reiniciar los materiales al comenzar
    global materiales_finales
    materiales_finales = []
    return render_template("index.html")

@app.route("/flujo/<flujo>")
def flujo(flujo):
    flujos = {
        "A": ("FLUJO A: Ajuste de medida", "ajuste_de_medida.xlsx", "B"),
        "B": ("FLUJO B: Tubo de saca", "saca_tubing.xlsx", "C"),
        "C": ("FLUJO C: Tubería de Baja", "baja_tubing.xlsx", "D"),
        "D": ("FLUJO D: Profundiza", "profundiza.xlsx", "E"),
        "E": ("FLUJO E: Baja varillas", "baja_varillas.xlsx", "F"),
        "F": ("FLUJO F: Abandona pozo", "abandono_recupero.xlsx", "G"),
        "G": ("FLUJO G: Instalación BM", "WO.xlsx", "H"),
        "H": ("FLUJO H: Material de agregación", "GENERAL.xlsx", None),
    }

    if flujo not in flujos:
        return redirect(url_for("index"))

    nombre_flujo, archivo, siguiente_flujo = flujos[flujo]
    siguiente = procesar_flujo(nombre_flujo, siguiente_flujo, archivo)
    
    return render_template("flujo.html", flujo=nombre_flujo, siguiente_flujo=siguiente, materiales=materiales_finales)

@app.route("/resultados")
def resultados():
    print(f"Mostrando resultados, {len(materiales_finales)} materiales registrados")
    
    if not materiales_finales:
        return "No hay materiales registrados. <a href='/'>Volver al inicio</a>"
    
    return render_template("resultados.html", materiales=materiales_finales)

# ===============================
# EJECUTAR SERVIDOR
# ===============================

if __name__ == "__main__":
    app.run(debug=True)
```

## templates/flujo.html

- Characters: 1316
- Tokens: 0

```html
<!-- templates/flujo.html -->
<!DOCTYPE html>
<html>
<head>
    <title>{{ flujo }}</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        button { 
            padding: 10px; 
            background-color: #4CAF50; 
            color: white; 
            border: none; 
            cursor: pointer; 
        }
        table {
            border-collapse: collapse;
            width: 100%;
            margin-top: 20px;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: #f2f2f2;
        }
        tr:nth-child(even) {
            background-color: #f9f9f9;
        }
    </style>
</head>
<body>
    <h1>{{ flujo }}</h1>
    
    <!-- Debug: Mostrar datos del último flujo -->
    {% if materiales %}
        <h3>Materiales del último flujo procesado:</h3>
        {% set ultimo_flujo, ultimo_df = materiales[-1] %}
        {{ ultimo_df.to_html() | safe }}
    {% endif %}
    
    <!-- Navegación -->
    {% if siguiente_flujo %}
        <a href="/flujo/{{ siguiente_flujo }}"><button>Continuar a Flujo {{ siguiente_flujo }}</button></a>
    {% else %}
        <a href="/resultados"><button>Ver Resultados Finales</button></a>
    {% endif %}
</body>
</html>
```

## templates/resultados.html

- Characters: 1411
- Tokens: 0

```html
<!-- templates/resultados.html -->
<!DOCTYPE html>
<html>
<head>
    <title>Resultados Finales</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        button { 
            padding: 10px; 
            background-color: #4CAF50; 
            color: white; 
            border: none; 
            cursor: pointer; 
        }
        table {
            border-collapse: collapse;
            width: 100%;
            margin: 20px 0;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: #f2f2f2;
        }
        tr:nth-child(even) {
            background-color: #f9f9f9;
        }
        .flujo-section {
            margin-bottom: 30px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
    </style>
</head>
<body>
    <h1>Listado final de materiales de todos los flujos ejecutados</h1>
    
    {% for flujo, df in materiales %}
        <div class="flujo-section">
            <h2>{{ flujo }}</h2>
            {% if df.empty %}
                <p>No hay datos disponibles para este flujo.</p>
            {% else %}
                {{ df.to_html(index=False) | safe }}
            {% endif %}
        </div>
    {% endfor %}
    
    <a href="/"><button>Volver al inicio</button></a>
</body>
</html>
```

## templates/index.html

- Characters: 484
- Tokens: 0

```html
<!-- templates/index.html -->
<!DOCTYPE html>
<html>
<head>
    <title>Inicio</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        button { 
            padding: 10px; 
            background-color: #4CAF50; 
            color: white; 
            border: none; 
            cursor: pointer; 
        }
    </style>
</head>
<body>
    <h1>Bienvenido a la Aplicación</h1>
    <a href="/flujo/A"><button>Iniciar Flujo A</button></a>
</body>
</html>
```

## Statistics

- Total Files: 8
- Total Characters: 34736
- Total Tokens: 0
```````

## README.md

- Characters: 830
- Tokens: 0

````markdown
# Visualizador de Excel

Esta aplicación simple permite visualizar archivos Excel como tablas HTML en un navegador web.

## Requisitos

- Python 3.6 o superior
- pip (gestor de paquetes de Python)

## Instalación

1. Clona o descarga este repositorio
2. Instala las dependencias:

```bash
pip install -r requirements.txt
```

## Uso

1. Coloca tus archivos Excel (.xlsx o .xls) en la carpeta `data` 
   (se creará automáticamente si no existe)
2. Ejecuta la aplicación:

```bash
python app.py
```

3. Abre tu navegador y ve a `http://localhost:5000`

## Notas

- La aplicación mostrará todos los archivos Excel (.xlsx o .xls) encontrados en la carpeta `data`
- Cada archivo se convertirá en una tabla HTML
- Puedes recargar la página para actualizar los datos si agregas nuevos archivos Excel mientras la aplicación está corriendo
````

## package.json

- Characters: 51
- Tokens: 0

```json
{
  "dependencies": {
    "repomix": "^0.3.0"
  }
}
```

## app.py

- Characters: 1665
- Tokens: 0

```python
from flask import Flask, render_template
import pandas as pd
import os

app = Flask(__name__)

# Directorio donde se almacenan los archivos Excel
DATA_DIR = os.path.join(os.getcwd(), "data")
if not os.path.exists(DATA_DIR):
    os.makedirs(DATA_DIR)

def cargar_excels():
    """Carga todos los archivos Excel en el directorio data"""
    tablas = []
    
    # Verificar si hay archivos en el directorio
    if not os.path.exists(DATA_DIR):
        return tablas
    
    # Listar todos los archivos en el directorio data
    archivos = [f for f in os.listdir(DATA_DIR) if f.endswith(('.xlsx', '.xls'))]
    
    for nombre_archivo in archivos:
        try:
            # Ruta completa del archivo
            ruta_archivo = os.path.join(DATA_DIR, nombre_archivo)
            
            # Cargar el archivo Excel
            df = pd.read_excel(ruta_archivo)
            
            # Limpiar datos (opcional)
            df.columns = df.columns.str.strip()
            
            # Agregar a la lista de tablas
            tablas.append((nombre_archivo, df))
            print(f"Archivo {nombre_archivo} cargado correctamente")
        except Exception as e:
            print(f"Error al cargar {nombre_archivo}: {e}")
    
    return tablas

@app.route("/")
def index():
    # Cargar todos los archivos Excel
    tablas = cargar_excels()
    
    # Convertir DataFrames a HTML
    tablas_html = []
    for nombre, df in tablas:
        html = df.to_html(classes='table table-striped', index=False)
        tablas_html.append((nombre, html))
    
    return render_template("index.html", tablas=tablas_html)

if __name__ == "__main__":
    app.run(debug=True)
```

## templates/flujo.html

- Characters: 1316
- Tokens: 0

```html
<!-- templates/flujo.html -->
<!DOCTYPE html>
<html>
<head>
    <title>{{ flujo }}</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        button { 
            padding: 10px; 
            background-color: #4CAF50; 
            color: white; 
            border: none; 
            cursor: pointer; 
        }
        table {
            border-collapse: collapse;
            width: 100%;
            margin-top: 20px;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: #f2f2f2;
        }
        tr:nth-child(even) {
            background-color: #f9f9f9;
        }
    </style>
</head>
<body>
    <h1>{{ flujo }}</h1>
    
    <!-- Debug: Mostrar datos del último flujo -->
    {% if materiales %}
        <h3>Materiales del último flujo procesado:</h3>
        {% set ultimo_flujo, ultimo_df = materiales[-1] %}
        {{ ultimo_df.to_html() | safe }}
    {% endif %}
    
    <!-- Navegación -->
    {% if siguiente_flujo %}
        <a href="/flujo/{{ siguiente_flujo }}"><button>Continuar a Flujo {{ siguiente_flujo }}</button></a>
    {% else %}
        <a href="/resultados"><button>Ver Resultados Finales</button></a>
    {% endif %}
</body>
</html>
```

## templates/resultados.html

- Characters: 1411
- Tokens: 0

```html
<!-- templates/resultados.html -->
<!DOCTYPE html>
<html>
<head>
    <title>Resultados Finales</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        button { 
            padding: 10px; 
            background-color: #4CAF50; 
            color: white; 
            border: none; 
            cursor: pointer; 
        }
        table {
            border-collapse: collapse;
            width: 100%;
            margin: 20px 0;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: #f2f2f2;
        }
        tr:nth-child(even) {
            background-color: #f9f9f9;
        }
        .flujo-section {
            margin-bottom: 30px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
    </style>
</head>
<body>
    <h1>Listado final de materiales de todos los flujos ejecutados</h1>
    
    {% for flujo, df in materiales %}
        <div class="flujo-section">
            <h2>{{ flujo }}</h2>
            {% if df.empty %}
                <p>No hay datos disponibles para este flujo.</p>
            {% else %}
                {{ df.to_html(index=False) | safe }}
            {% endif %}
        </div>
    {% endfor %}
    
    <a href="/"><button>Volver al inicio</button></a>
</body>
</html>
```

## templates/index.html

- Characters: 2427
- Tokens: 0

```html
<!DOCTYPE html>
<html>
<head>
    <title>Visualizador de Excel</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            padding: 0;
        }
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
        }
        .tabla-contenedor {
            margin-bottom: 40px;
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        h2 {
            color: #4CAF50;
            margin-top: 0;
        }
        .table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }
        .table th {
            background-color: #4CAF50;
            color: white;
            padding: 10px;
            text-align: left;
        }
        .table td {
            border: 1px solid #ddd;
            padding: 8px;
        }
        .table-striped tr:nth-child(even) {
            background-color: #f2f2f2;
        }
        .mensaje-vacio {
            text-align: center;
            padding: 20px;
            background-color: #f8f9fa;
            border-radius: 5px;
            color: #6c757d;
        }
        .reload-btn {
            display: block;
            width: 200px;
            margin: 20px auto;
            padding: 10px;
            background-color: #4CAF50;
            color: white;
            text-align: center;
            text-decoration: none;
            border-radius: 4px;
            font-weight: bold;
            border: none;
            cursor: pointer;
        }
        .reload-btn:hover {
            background-color: #45a049;
        }
    </style>
</head>
<body>
    <h1>Visualizador de Excel</h1>
    
    <form action="/" method="get">
        <button type="submit" class="reload-btn">Recargar Datos</button>
    </form>
    
    {% if tablas %}
        {% for nombre, tabla_html in tablas %}
            <div class="tabla-contenedor">
                <h2>{{ nombre }}</h2>
                {{ tabla_html | safe }}
            </div>
        {% endfor %}
    {% else %}
        <div class="mensaje-vacio">
            <p>No se encontraron archivos Excel en la carpeta "data".</p>
            <p>Por favor, coloque sus archivos Excel en la carpeta "data" y recargue la página.</p>
        </div>
    {% endif %}
</body>
</html>
```

## Statistics

- Total Files: 8
- Total Characters: 44749
- Total Tokens: 0
